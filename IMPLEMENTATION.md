# Implementation checklist

Adapted from https://socialhub.activitypub.rocks/t/guide-for-new-activitypub-implementers/479/2#the-activitypub-spec-in-checkboxes-1

Numbered section references refer to the [ActivityPub specification](https://www.w3.org/TR/activitypub/).

The goal is to write tests for as many of these 92 cases as is applicable.

## The tests

- [x] 1. `(outbox:accept-activities:MUST)` Accepts Activity objects. test "outbox MUST accept activities" in module FediServerWeb.OutboxControllerTest
- [x] 2. `(outbox:accept-non-activity-objects:MUST)` Accepts non-Activity objects, and converts to Create Activities per 7.1.1. test "outbox MUST accept non activity objects" in module FediServerWeb.OutboxControllerTest
- [x] 3. `(outbox:remove-bto-and-bcc:MUST)` Removes the 'bto' and 'bcc' properties from Objects before storage and delivery. test "outbox MUST remove bto and bcc" in module TODO_Test
- [x] 4. `(outbox:ignore-id:MUST)` Ignores id on submitted objects, and generates a new id instead. test "outbox MUST ignore id" in module FediServerWeb.OutboxControllerTest
- [x] 5. `(outbox:respond-with-201-status:MUST)` Responds with a status code of 201 Created. test "outbox MUST respond with 201 status" in module FediServerWeb.OutboxControllerTest
- [x] 6. `(outbox:set-location-header:MUST)` Responds with a Location header whose value is id of new object, unless the Activity is transient. test "outbox MUST set location header" in module FediServerWeb.OutboxControllerTest
- [x] 7. `(outbox:trust-submitted-content:SHOULD-NOT)` Does not trust client submitted content. test "outbox SHOULD NOT trust submitted content" in module OutboxControllerTest
- [x] 8. `(outbox:validate-content:SHOULD)` Validates the content they receive to avoid content spoofing attacks. test "outbox SHOULD validate content" in module OutboxControllerTest
- [ ] 9. `(outbox:overload-other-servers:SHOULD-NOT)` Takes care not to overload other servers with delivery submissions. test "outbox SHOULD NOT overload other servers" in module TODO_Test
- [ ] 10. `(outbox:upload-media:accept:MUST)` Accepts Uploaded Media in submissions. test "outbox upload media MUST accept" in module TODO_Test
- [ ] 11. `(outbox:upload-media:accept-file-parameter:MUST)` Accepts 'uploadedMedia' file parameter. test "outbox upload media MUST accept file parameter" in module TODO_Test
- [ ] 12. `(outbox:upload-media:accept-object-parameter:MUST)` Accepts 'uploadedMedia' object parameter. test "outbox upload media MUST accept object parameter" in module TODO_Test
- [ ] 13. `(outbox:upload-media:respond-201-or-202-status:MUST)` Responds with a status code of 201 Created or 202 Accepted per the example in the [ActivityPub Media Upload Report](https://www.w3.org/wiki/SocialCG/ActivityPub/MediaUpload). test "outbox upload media MUST respond 201 or 202 status" in module TODO_Test
- [ ] 14. `(outbox:upload-media:respond-location-header:MUST)` Responds with a Location header pointing to the to-be-created object's id. test "outbox upload media MUST respond location header" in module TODO_Test
- [ ] 15. `(outbox:upload-media:append-id:MUST)` Appends an 'id' property to the new object. test "outbox upload media MUST append id" in module TODO_Test
- [ ] 16. `(outbox:upload-media:include-new-url:SHOULD)` After receiving submission with uploaded media, includes the upload's new URL in the submitted object's 'url' property. test "outbox upload media SHOULD include new url" in module TODO_Test
- [x] 17. `(outbox:create:merge-audience-properties:SHOULD)` Merges audience properties--'to', 'bto', 'cc', 'bcc', 'audience'--with the Create's object's audience properties. test "outbox create SHOULD merge audience properties" in module OutboxControllerTest
- [x] 18. `(outbox:create:copy-actor-to-attributedTo:SHOULD)` Copies a Create's 'actor' property to be the value of the object's 'attributedTo' property. test "outbox create SHOULD copy actor to attributedTo" in module OutboxControllerTest
- [x] 19. `(outbox:update:check-authorization:MUST)` Takes care to be sure that an Update activity is authorized to modify its object before modifying the server's stored copy. test "outbox update MUST check authorization" in module OutboxControllerTest
- [ ] 20. `(outbox:update:support-partial-updates:NON-NORMATIVE)` Supports partial updates in client-to-server, but not server-to-server, protocol. test "outbox update MAY support partial updates (non-normative)" in module TODO_Test
- [x] 21. `(outbox:follow:add-followed-object:SHOULD)` Adds followed object to the actor's Following Collection. test "outbox follow SHOULD add followed object" in module OutboxControllerTest
- [x] 22. `(outbox:add:add-object-to-target:SHOULD)` Adds object to the target Collection, unless not allowed due to requirements in 7.5. test "outbox add SHOULD add object to target" in module OutboxControllerTest
- [x] 23. `(outbox:remove:remove-object-from-target:SHOULD)` Removes object from the target Collection, unless not allowed due to requirements in 7.5. test "outbox remove SHOULD remove object from target" in module OutboxControllerTest
- [x] 24. `(outbox:like:add-object-to-liked:SHOULD)` Adds the object to the actor's Liked Collection. test "outbox like SHOULD add object to liked" in module OutboxControllerTest
- [x] 25. `(outbox:block:prevent-interaction-with-actor:SHOULD)` Prevents the blocked object from interacting with any object posted by the actor. test "outbox block SHOULD prevent interaction with actor" in module OutboxControllerTest
- [x] 26. `(outbox:undo:be-supported:NON-NORMATIVE)` Supports the Undo activity in the client-to-server protocol. test "outbox undo MAY be supported (non-normative)" in module TODO_Test
- [x] 27. `(outbox:undo:ensure-activity-and-actor-are-same:MUST)` Ensures that the actor in the activity actor is the same in activity being undone. test "outbox undo MUST ensure activity and actor are same" in module TODO_Test
- [x] 27.1 `(outbox:retrieval:respond-unauthorized-with-public-contents:MUST)` Responds with all of the Public posts in the outbox if a user submits a request without Authorization. test "outbox retrieval MUST respond unuathorized with public contents" in module OutboxControllerTest.
- [x] 27.2 `(outbox:retrieval:respond-with-filtered-contents:MUST)` Responds with the contents of the outbox filtered by the permissions of the person reading it. test "outbox retrieval MUST respond with filtered contents" in module OutboxControllerTest.
- [x] 28. `(inbox:delivery:perform-delivery:MUST)` Performs delivery on all Activities posted to the outbox. test "inbox delivery MUST perform delivery" in module InboxDeliveryTest
- [x] 29. `(inbox:delivery:determine-all-recipients:MUST)` Utilizes 'to', 'bto', 'cc', and 'bcc' to determine delivery recipients. test "inbox delivery MUST determine all recipients" in InboxDeliveryTest
- [x] 30. `(inbox:delivery:add-id:MUST)` Provides an id on all Activities sent to other servers, unless the activity is intentionally transient. test "inbox delivery MUST add id" in module TODO_Test
- [x] 31. `(inbox:delivery:submit-with-credentials:MUST)` Dereferences delivery targets with the submitting user's credentials. test "inbox delivery MUST submit with credentials" in module InboxDeliveryTest
- [x] 32. `(inbox:delivery:deliver-to-collection:MUST)` Delivers to all items in recipients that are Collections or OrderedCollections. test "inbox delivery MUST deliver to collection" in module InboxDeliveryTest
- [x] 33. `(inbox:delivery:deliver-to-collection:deliver-recursively:MUST)` Applies the above, recursively if the Collection contains Collections, and limits the recursion depth. test "inbox delivery deliver to collection MUST deliver recursively" in module InboxDeliveryTest
- [x] 34. `(inbox:delivery:deliver-with-object-for-certain-activities:MUST)` Delivers activity with 'object' property if the Activity type is one of Create, Update, Delete, Follow, Add, Remove, Like, Block, Undo. test "inbox delivery MUST deliver with object for certain activities" in module InboxDeliveryTest
- [x] 35. `(inbox:delivery:deliver-with-target-for-certain-activities:MUST)` Delivers activity with 'target' property if the Activity type is one of Add, Remove. test "inbox delivery MUST deliver with target for certain activities" in module InboxDeliveryTest
- [x] 36. `(inbox:delivery:deduplicate-final-recipient-list:MUST)` Deduplicates final recipient list. test "inbox delivery MUST deduplicate final recipient list" in module InboxDeliveryTest
- [x] 37. `(inbox:delivery:deliver-to-actor:MUST-NOT)` Does not deliver to recipients which are the same as the actor of the Activity being notified about. test "inbox delivery MUST NOT deliver to actor" in module InboxDeliveryTest
- [x] 38. `(inbox:delivery:deliver-block:SHOULD-NOT)` SHOULD NOT deliver Block Activities to their object. test "inbox delivery SHOULD NOT deliver block" in module TODO_Test
- [x] 39. `(inbox:delivery:sharedInbox:deliver:MAY)` Delivers to 'sharedInbox' endpoints to reduce the number of receiving actors delivered to by identifying all followers which share the same sharedInbox who would otherwise be individual recipients and instead deliver objects to said sharedInbox. test "inbox delivery sharedInbox MAY deliver" in module InboxDeliveryTest
- [x] 40. `(inbox:delivery:sharedInbox:deliver-to-inbox-if-no-sharedInbox:MUST)` For servers which deliver to 'sharedInbox': delivers to actor inboxes and collections otherwise addressed which do not have a sharedInbox. test "inbox delivery sharedInbox MUST deliver to inbox if no sharedInbox" in module InboxDeliveryTest
- [ ] 40.1 `(inbox:delivery:set-followers-sync-header:MAY)` When delivering a Create activity to a sender's followers, sets a Collection-Synchronization header intended for the corresponding instance, per [FEP-8fcf](https://socialhub.activitypub.rocks/pub/fep-8fcf-followers-collection-synchronization-across-servers). test "inbox delivery MAY set followers sync header" in module TODO_Test
- [x] 41. `(inbox:accept:deduplicate:MUST)` Deduplicates activities returned by the inbox by comparing activity ids. test "inbox accept MUST deduplicate" in module InboxControllerTest
- [x] 42. `(inbox:accept:special-forward:MUST)` Forwards incoming activities to the values of 'to', 'bto', 'cc', 'bcc', and 'audience' if and only if criteria in 7.1.2 are met. test "inbox accept MUST special forward" in module InboxControllerTest
- [ ] 43. `(inbox:accept:special-forward:recurse:SHOULD)` Recurses through 'to', 'bto', 'cc', 'bcc', and 'audience' object values to determine whether/where to forward according to criteria in 7.1.2. test "inbox accept special forward SHOULD recurse" in module TODO_Test
- [ ] 44. `(inbox:accept:special-forward:limit-recursion:SHOULD)` Limits recursion in this process. test "inbox accept special forward SHOULD limit recursion" in module TODO_Test
- [x] 45. `(inbox:accept:create:be-supported:NON-NORMATIVE)` Supports receiving a Create object in an actor's inbox. test "inbox accept create MAY be supported (non-normative)" in module InboxControllerTest
- [x] 46. `(inbox:accept:delete:remove-object:SHOULD)` Assuming object is owned by sending actor/server, removes object's representation. test "inbox accept delete SHOULD remove object" in module InboxControllerTest
- [ ] 47. `(inbox:accept:delete:replace-with-tombstone:MAY)` Replaces object's representation with a Tombstone object. test "inbox accept delete MAY replace with tombstone" in module TODO_Test
- [x] 48. `(inbox:accept:update:be-authorized:MUST)` Takes care to be sure that the Update is authorized to modify its object. test "inbox accept update MUST be authorized" in module InboxControllerTest
- [x] 49. `(inbox:accept:update:completely-replace-activity:SHOULD)` Completely replaces its copy of the activity with the newly received value). test "inbox accept update SHOULD completely replace activity" in module InboxControllerTest
- [x] 50. `(inbox:accept:trust-unverified-content:SHOULD-NOT)` Doesn't trust content received from a server other than the content's origin without some form of verification. test "inbox accept SHOULD NOT trust unverified content" in module InboxControllerTest
- [x] 51. `(inbox:accept:follow:add-actor-to-users-followers:SHOULD)` Adds the actor to the object user's Followers Collection. test "inbox accept follow SHOULD add actor to users followers" in module InboxControllerTest
- [x] 52. `(inbox:accept:follow:generate-accept-or-reject:SHOULD)` Generates either an Accept or Reject activity with Follow as object and deliver to actor of the Follow. test "inbox accept follow SHOULD generate accept or reject" in module InboxControllerTest
- [x] 53. `(inbox:accept:accept:add-actor-to-users-following:SHOULD)` If in reply to a Follow activity, adds actor to receiver's Following Collection. test "inbox accept accept SHOULD add actor to users following" in module InboxControllerTest
- [x] 54. `(inbox:accept:reject:add-actor-to-users-following:MUST-NOT)` If in reply to a Follow activity, MUST NOT add actor to receiver's Following Collection. test "inbox accept reject MUST NOT add actor to users following" in module InboxControllerTest
- [x] 55. `(inbox:accept:add:add-to-collection:SHOULD)` Adds the object to the Collection specified in the 'target' property, unless not allowed to per requirements in 7.8. test "inbox accept add SHOULD add to collection" in module InboxControllerTest
- [x] 56. `(inbox:accept:remove:remove-from-collection:SHOULD)` Removes the object from the Collection specified in the 'target' property, unless not allowed per requirements in 7.9. test "inbox accept remove SHOULD remove from collection" in module TODO_Test
- [x] 57. `(inbox:accept:like:indicate-like-performed:SHOULD)` Performs appropriate indication of the like being performed. See 7.10 for examples. test "inbox accept like SHOULD indicate like performed" in module InboxControllerTest
- [x] 58. `(inbox:accept:announce:add-to-shares-collection:SHOULD)` Increments the object's count of shares by adding the received activity to the 'shares' collection if this collection is present. test "inbox accept announce SHOULD add to shares collection" in module InboxControllerTest
- [ ] 59. `(inbox:accept:undo-federated:NON-NORMATIVE)` Performs Undo of the object in the federated context. test "inbox accept MAY undo federated (non-normative)" in module InboxControllerTest
- [ ] 60. `(inbox:accept:validate-content:SHOULD)` Validates the content they receive to avoid content spoofing attacks. test "inbox accept SHOULD validate content" in module InboxControllerTest
- [ ] 60.1 `(inbox:accept:followers-sync:remove-unlisted-actors:SHOULD)` Removes from its followers collection any local actor not listed in the decoded partial followers collection per [FEP-8fcf](https://socialhub.activitypub.rocks/pub/fep-8fcf-followers-collection-synchronization-across-servers). test "inbox accept followers sync SHOULD remove unlisted actors" in module TODO_TEST
- [ ] 60.2 `(inbox:accept:followers-sync:accept-pending-follows:MAY)` Considers any pending outgoing follow listed in the decoded partial followers collection as accepted per [FEP-8fcf](https://socialhub.activitypub.rocks/pub/fep-8fcf-followers-collection-synchronization-across-servers). test "inbox accept followers sync MAY accept pending follows" in module TODO_TEST
- [ ] 60.3 `(inbox:accept:followers-sync:send-undo:SHOULD)` Sends an Undo Follow for any local follower listed in the decoded
partial followers collection but not known locally per [FEP-8fcf](https://socialhub.activitypub.rocks/pub/fep-8fcf-followers-collection-synchronization-across-servers). test "inbox accept followers sync SHOULD send undo" in module TODO_TEST
- [x] 61. `(server:inbox:respond-to-get:NON-NORMATIVE)` Responds to GET request at inbox URL. test "server inbox MAY respond to get (non-normative)" in module InboxControllerTest
- [x] 62. `(server:inbox:be-orderedCollection:MUST)` inbox is an OrderedCollection. test "server inbox MUST be orderedCollection" in module InboxControllerTest
- [ ] 63. `(server:inbox:filter-per-permissions:SHOULD)` Filters inbox content according to the requester's permission. test "server inbox SHOULD filter per permissions" in module TODO_Test
- [x] 64. `(server:object-retrieval:dereference-id:MAY)` Allow dereferencing Object ids by responding to HTTP GET requests with a representation of the Object. test "server object retrieval MAY dereference id" in module ObjectsControllerTest
- [x] 65. `(server:object-retrieval:respond-with-ld+json:MUST)` Responds with the ActivityStreams object representation in response to requests that primarily Accept the media type application/ld+json; profile="https://www.w3.org/ns/activitystreams". test "server object retrieval MUST respond with ld+json" in module ObjectsControllerTest
- [x] 66. `(server:object-retrieval:respond-with-activity+json:SHOULD)` Responds with the ActivityStreams object representation in response to requests that primarily Accept the media type application/activity+json. test "server object retrieval SHOULD respond with activity+json" in module ObjectsControllerTest
- [x] 67. `(server:object-retrieval:deleted-object:respond-with-tombstone:MAY)` Responds with response body that is an ActivityStreams Object of type Tombstone, if the server is choosing to disclose that the object has been removed. test "server object retrieval deleted object MAY respond with tombstone" in module ObjectsControllerTest
- [x] 68. `(server:object-retrieval:deleted-object:respond-with-410-status:SHOULD)` Responds with 410 Gone status code if Tombstone is in response body, otherwise responds with 404 Not Found. test "server object retrieval deleted object SHOULD respond with 410 status" in module ObjectsControllerTest
- [x] 69. `(server:object-retrieval:deleted-object:respond-with-404-status:SHOULD)` Responds with 404 status code for Object URIs that have never existed. test "server object retrieval deleted object SHOULD respond with 404 status" in module ObjectsControllerTest
- [x] 70. `(server:object-retrieval:respond-private-with-403-or-404-status:SHOULD)` Responds with a 403 Forbidden status code to all requests that access Objects considered Private; or 404 if the server does not want to disclose the existence of the object; or another HTTP status code if specified by the authorization method. test "server object retrieval SHOULD respond private with 403 or 404 status" in module ObjectsControllerTest
- [x] 71. `(server:security-considerations:verify-content-posted-by-actor:NON-NORMATIVE)` Verifies that the new content is really posted by the actor indicated in Objects received in inbox. test "server security considerations inbox MAY verify content posted by actor (non-normative)" in module InboxControllerTest
- [x] 71.1 `(server:security-considerations:outbox:verify-content-posted-by-actor:NON-NORMATIVE)` Verifies that the new content is really posted by the actor indicated in Objects received in outbox. test "server security considerations outbox MAY verify content posted by actor (non-normative)" in module OutboxControllerTest
- [ ] 72. `(server:security-considerations:not-deliver-to-localhost:NON-NORMATIVE)` By default, the server does not make HTTP requests to localhost when delivering Activities. test "server security considerations MAY not deliver to localhost (non-normative)" in module TODO_Test
- [ ] 73. `(server:security-considerations:apply-uri-scheme-whitelist:NON-NORMATIVE)` Applies a whitelist of allowed URI protocols before issuing requests, e.g. for inbox delivery. test "server security considerations MAY apply uri scheme whitelist (non-normative)" in module TODO_Test
- [ ] 74. `(server:security-considerations:filter-incoming-content:NON-NORMATIVE)` Filters incoming content both by local untrusted users and any remote users through some sort of spam filter. test "server security considerations MAY filter incoming content (non-normative)" in module TODO_Test
- [ ] 75. `(server:security-considerations:sanitize-fields:NON-NORMATIVE)` Takes care to sanitize fields containing markup to prevent cross site scripting attacks). test "server security considerations MAY sanitize fields (non-normative)" in module TODO_Test
- [ ] 76. `(client:submission:discover-url-from-profile:MUST)` Client discovers the URL of a user's outbox from their profile. test "client submission MUST discover url from profile" in module TODO_Test
- [ ] 77. `(client:submission:submit-post-with-content-type:MUST)` Client submits activity by sending an HTTP post request to the outbox URL with the Content-Type of application/ld+json; profile="https://www.w3.org/ns/activitystreams". test "client submission MUST submit post with content type" in module TODO_Test
- [ ] 78. `(client:submission:submit-objects:MUST)` Client submission request body is either a single Activity or a single non-Activity Object. test "client submission MUST submit objects" in module TODO_Test
- [ ] 79. `(client:submission:submit-objects:provide-object:MUST)` Client provides the 'object' property when submitting the following activity types to an outbox: Create, Update, Delete, Follow, Add, Remove, Like, Block, Undo. test "client submission submit objects MUST provide object" in module TODO_Test
- [ ] 80. `(client:submission:submit-objects:provide-target:MUST)` Client provides the 'target' property when submitting the following activity types to an outbox: Add, Remove.. test "client submission submit objects MUST provide target" in module TODO_Test
- [ ] 81. `(client:submission:be-authenticated:MUST)` Client submission request is authenticated with the credentials of the user to whom the outbox belongs. test "client submission MUST be authenticated" in module TODO_Test
- [ ] 82. `(client:submission:support-uploading-media:MUST)` Client supports uploading media by sending a multipart/form-data request body. test "client submission MUST support uploading media" in module TODO_Test
- [ ] 83. `(client:submission:recursively-add-targets:SHOULD)` Before submitting a new activity or object, Client infers appropriate target audience by recursively looking at certain properties such as 'inReplyTo', and adds these targets to the new submission's audience per 6.1. test "client submission SHOULD recursively add targets" in module TODO_Test
- [ ] 84. `(client:submission:recursively-add-targets:limit-depth:SHOULD)` Client limits depth of this recursion. test "client submission recursively add targets SHOULD limit depth" in module TODO_Test
- [ ] 85. `(client:retrieval:accept-ld+json-header:MUST)` When retrieving objects, Client specifies an Accept header with the application/ld+json; profile="https://www.w3.org/ns/activitystreams" media type. test "client retrieval MUST accept ld+json header" in module TODO_Test

## Notes

- `(outbox:remove-bto-and-bcc:MUST)` The original go-fed code added activities to
  the outbox first, then delivered them. This means that 'bto' and 'bcc' are not
  stripped when they are added to the outbox. Code was added to remove 'bto' and 'bcc'
  when retrieving data from the database.